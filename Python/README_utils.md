<!-- TOC -->
# [utils.py](./utils.py)
## Contents
- [utils.py](#utilspy)
  - [Contents](#contents)
  - [GetSFR](#getsfr)
    - [Parameters](#parameters)
    - [Returns](#returns)
  - [massFunction](#massfunction)
    - [Parameters](#parameters-1)
    - [Local](#local)
    - [Global](#global)
    - [Returns](#returns-1)
    - [Warning](#warning)
  - [ImportOriData](#importoridata)
    - [Parameters](#parameters-2)
    - [Returns](#returns-2)
    - [Examples](#examples)
  - [DELallrbwind](#delallrbwind)
    - [Parameters](#parameters-3)
    - [Returns](#returns-3)
    - [Criterion](#criterion)
    - [Warning](#warning-1)
  - [Beamingfactor](#beamingfactor)
    - [Parameters](#parameters-4)
    - [Returns](#returns-4)
  - [OBSplot](#obsplot)
    - [Parameters](#parameters-5)
    - [Returns](#returns-5)
  - [plot_Lx_mesaNS](#plot_lx_mesans)
    - [Parameters](#parameters-6)
    - [Returns](#returns-6)
    - [Warning](#warning-2)
  - [~~plot_Lx_b_mesa~~](#plot_lx_b_mesa)
  - [plot_Lx_NNsum_gedian](#plot_lx_nnsum_gedian)
    - [Parameters](#parameters-7)
    - [Returns](#returns-7)
  - [plot_lx_tb_gedian_paper](#plot_lx_tb_gedian_paper)
    - [Parameters](#parameters-8)
    - [Returns](#returns-8)
  - [plot_mass_tb_gedian_paper](#plot_mass_tb_gedian_paper)
    - [Parameters](#parameters-9)
    - [Returns](#returns-9)
  - [~~SETplot~~](#setplot)

In this document, I will introduce every function in [utils.py](./utils.py)

## GetSFR
Calculate the Binary Star forming rate of this program
### Parameters

SFR: float, original star forming rate obtained by obsercation.

MminMINE: float or double, minimum higher initial mass.

alpha: float or double, the exponent of mass function, which is different according to different version of mass function.

qav: float, average mass ratio (q) of popbin program (default: 0.535)

binary: int, Whether your SFR is for binary or all stars. ONLY 0 or 1!

MminSFR: float, the minimum mass taken into account while caculating SFR.

### Returns

Sb: float, Binary Star forming rate of this program
## massFunction
Calculate the birth rate of particular binary system.
        
### Parameters
### Local

mass: Double or float, the **higher** initial mass of binaries system.
### Global

AllmassNUM: int, total mass number of Popbin.

M1MAX: float or double, maximum higher initial mass  

M1MIN: float or double, minimum higher initial mass  

SFR: float or double, binary star forming rate 

qNUM: int, total q (mass ratio) number of Popbin.  

aNUM: int, total a (seperation) number of Popbin.

alpha: float or double, the exponent of mass function, which is different according to different version of mass function.

### Returns

rate: float, the birth rate of particular binary system.

### Warning 

This function only support initial mass heavier than 1 solar mass! Otherwise the birth rate will be None!
## ImportOriData
Import original data generated by Popbin_mine.f in ../Fortran0415, and delete some irrelated data. Finally output two array in the structured form.

Please make sure your data files saved in ``{DataFolder}/{OutName}/all_Lx37erg_z0.01_rb_{OutName}.out``

### Parameters
NumParallel : int, the same as the setting in popbin program, (default: 1)

DataFolder : string, the data saving folder of original output of popbin program.

OutName : string, the same as the setting in popbin program, which is the version of popbin program.

SaveNPY : bool, whether this program save the all_rb and all_wind array in NPY form in the same file folder. 

LoadNPY : bool, whether this program load the all_rb and all_wind array in NPY form in the same file folder. Please set it to ``False`` in the first time. NPY form can speed up the loading progress significantly.

### Returns

RLselected: 2-D array, the meaning of each column are as folowing. The output array have been selected by ``DELallrbwind`` function.

Windseleted: 2-D array, the meaning of each column are as folowing. The output array have been selected by ``DELallrbwind`` function.

|Column| 0  |   1   |    2    |   3  |     4    |   5 |      6    |   7   |    8   |    9     |
|  :----:  | :----:  | :----:  | :----:  | :----:  | :----:  | :----:  | :----:  | :----:  |:----:  | :----:  |
|all_wind_1/WindSelected| m1|   m2|     Lx|     ecc0|   a|      tb0|    mt1|    mt2|    kw|   kw2|   
|all_rb_1/RLselected| m1|   m2|     Lx|     ecc0|   a|      tb0|    mt1|    mt2|    kw|   kw2|    

|Column| 10   |   11  |    12   |   13    |  14    |  15         |     16      |17    |  18     | 19|
|  :----:  | :----:  | :----:  | :----:  | :----:  | :----:  | :----:  | :----:  | :----:  |:----:  | :----:  | 
|all_wind_1/WindSelected| mx|     mx2|    eccx|   tbx|    f|      nnn|            uuu|    m_tr|   i   |    delta T|
|all_rb_1/RLselected| mx|     mx2|    eccx|   tbx|    f|      m_transferrate| b_iso|  m_tr|   i   |  delta T|

### Examples
```    python
#!/usr/bin/env python3
from utils import *
all_rb_1,all_wind_1 = ImportOriData(
                        NumParallel     = 8,
                        DataFolder      = '..\Data',
                        OutName         = '0415',
                        SaveNPY         = True,
                        LoadNPY         = False)
all_rb_1,all_wind_1 = ImportOriData(
                        NumParallel     = 1,
                        DataFolder      = '..\Data',
                        OutName         = '0415',
                        SaveNPY         = False,
                        LoadNPY         = True)

```

## DELallrbwind

Calculate the Binary Star forming rate of this program
### Parameters

all_rb: 2-D array, original data of Roche-lobe binaries obtained from Fortran0415 ``popbin_mine.f`` program.

all_wind: 2-D array, original data of Wind Roche-lobe binaries obtained from Fortran0415 ``popbin_mine.f`` program.

minLx: float or double, minimum luminosity of selection. (default: 39)

CHAbeamingFlag: bool, Whether changing beaming mode. ABANDONED! (default: False)

eddfac: double, Maximum edding factor of selection (default: 1e4)

DELtmax: float, Maximum evolution time of selection (default: 200 for Ring Galaxies)

MaxDuration: float, Maximum stage duration of selection. In other words, the duration between two row of original bcm array in bse may be longer than several million year which is unrealiable for rapid mass transfer. (default: 1)


### Returns

RLselected: 2-D array, Selected array

Windseleted: 2-D array, Selected array

### Criterion

We delete following data which follows those criterion.
- less than Maximum evolution time of selection
- mass1 is smaller than 2Msun, which is unstable.
- orbit is 0
- $\delta T$ < 0
- $\delta T$ > MaxDuration
- Lx is lower than Lxmin

### Warning 
Please never set eddfac smaller than $10^4$ or set CHAbeamingFlag to True untill you understand this part of code!

## Beamingfactor
Different mode for beaming. The larger b is, the realistic the result is (maybe).

### Parameters

b: float, beaming factor.

beaming: int, mode for caculation of beaming factor. The larger b is, the realistic the result is (maybe).(Defaut: 1)
- 0 无修正：数目不做调整
- 1 直接乘以b：数目乘以b=观测的数目
- 2 方法二：像我昨天下午发的修正，乘以(8*b).^0.5/pi
- 3 方法三，调整了一些估计项acos(1-b)*2/pi

### Returns

Beaming factor
## OBSplot
Plot the observation result of Wolter 2018 in seven Ring Galaxies.

|num|Ring Galaxies|SFR|
|  :----:  | :----:  |:----:  |
|1|AM0644x3	|2.6|
|2|Arp148x1	|2.5|
|3|Arp143	|2.3|
|4|Cartwheel	|20.0|
|5|N922	|8.0|
|6|Arp 147-Ring	|4.1|
|7|Arp 284	|4.0|

### Parameters

logFlag: {bool,0,1}, whether return a log10(num) result or not. 

obs: (local) 1-d array, the original observation data.

### Returns

This function return a turple

obssort: array, the luminosity of each ULXs in seven Ring Galaxies in order.

num: 1-D array, the number of ULXs more luminous than each luminosity of obssort.
```python
num = np.linspace(len(obssort),1,len(obssort))
```
## plot_Lx_mesaNS
Different mode for beaming. The larger b is, the realistic the result is (maybe).

### Parameters

beaming: float, beaming factor.

tmax: float, maximum evolution time for bianries.

Number_XLFpoint: int, the length of the array while ploting XLF.

minLx: float, minimum luminosity of XLF.

maxLx: float, maximum luminosity of XLF.

fileFolder: path, the saving path of mesa data 

### Returns

NNsumwind: array, the number of predicted ULXs via Roche-Lobe overflow by mesa program which is more luminous than particular luminosity.

NNsumrb: array, the number of predicted ULXs via Wind Roche-Lobe overflow by mesa program which is more luminous than particular luminosity.

### Warning

make sure that there is Lx_N1207.npy and hanchen_first_neutron1124.out in your file folder!

## ~~plot_Lx_b_mesa~~
Abandoned!
## plot_Lx_NNsum_gedian
Generate data for ploting the X-ray Luminosity function(XLF). 

### Parameters

data: 2-D array, in the same form with all_rb_1 or all_wind_1, and could be part of them.
beaming: float, beaming factor.

Number_XLFpoint: int, the length of the array while ploting XLF.

minLx: float, minimum luminosity of XLF.

maxLx: float, maximum luminosity of XLF.

### Returns
(NNsum,Lx_x,np.log10(NNsum))
NNsum: 1-D array, the number of predicted ULXs which is more luminous than particular luminosity (Lx_x) obtained from the input data.

Lx_x: 1-D array, particular luminosity (Lx_x) 
```python
Lx_x = np.linspace(minLx,maxLx,Number_XLFpoint)
```
## plot_lx_tb_gedian_paper
Generate data for ploting the distribution of luminosity-orbit plane.

### Parameters

data_ori: 2-D array, in the same form with all_rb_1 or all_wind_1, and could be part of them.

beaming: float, beaming factor.

Number_Lx: int, the length of the array related to luminosity.

Number_orb: int, the length of the array related to orbit.

my_title: string, title of this figure.

Limit_cri: number, the minimum distribution for showing in the plot. For example, if Limit_cri=1000 and the maximum distribution is 1. then the plot will not display distribution less than 1/1000.

### Returns
NN: 2-D array, the distribution number of each panel.
## plot_mass_tb_gedian_paper
Generate data for ploting the distribution of mass-orbit plane.

### Parameters

data_ori: 2-D array, in the same form with all_rb_1 or all_wind_1, and could be part of them.
beaming: float, beaming factor.

Number_mass: int, the length of the array related to mass.

Number_orb: int, the length of the array related to orbit.

my_title: string, title of this figure.

Limit_cri: number, the minimum distribution for showing in the plot. For example, if Limit_cri=1000 and the maximum distribution is 1. then the plot will not display distribution less than 1/1000.

### Returns
NN: 2-D array, the distribution number of each panel.
## ~~SETplot~~
Abandoned!